#!/usr/bin/env bash

install_crossref() {

    get_archive() {
        file_name="$1"
        url=https://github.com/lierdakil/pandoc-crossref/releases/download/v0.3.8.4/"$file_name"
        axel --quiet -n 3 "$url"
    }

    do_install() {
        file_name=pandoc-crossref-Linux.tar.xz

        if ! [[ -f "$file_name" ]]; then
            get_archive "$file_name"
        fi

        if ! [[ -f "pandoc-crossref" ]]; then
            tar -xf "$file_name"
        fi

        if [[ -f "pandoc-crossref" ]]; then
            mkdir -p ~/.local/bin ~/.local/man \
                && mv pandoc-crossref ~/.local/bin \
                && mv pandoc-crossref.1 ~/.local/man
        fi
    }

    (temp_dir="$(mktemp -d)"; \
        cd "$temp_dir" \
        && do_install \
        && cd - \
        && rm -rf "$temp_dir")
}

main() {
    install_crossref
}

main "$@"
